---
import MainLayout from "../layouts/MainLayout.astro";
import Button from "../components/Button.astro";
import Link from "../components/Link.astro";
import Anmeldelse from "../components/Anmeldelse.astro";
import Produkter from "../components/Produkter.astro";
import { Image } from "astro:assets";

import herovideo from "../assets/images/herovideo.mp4";
import stjerne from "../assets/images/stjerne.svg";
import barista from "../assets/images/barista.webp";
import instagram1 from "../assets/images/instagram1.webp";
import instagram2 from "../assets/images/instagram2.webp";
import instagram3 from "../assets/images/instagram3.webp";

import kaffekop from "../assets/images/kaffekop.webp";
import kaffeplante2 from "../assets/images/kaffeplante2.webp";

const data = await fetch(
  "https://rzrjmncawmbiwybkfevi.supabase.co/rest/v1/products",
  {
    method: "GET",
    headers: {
      apikey:
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6cmptbmNhd21iaXd5YmtmZXZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4NjM5MDQsImV4cCI6MjA2MTQzOTkwNH0.fZH4Fc4wDSH_YNjx4pfHsh8rdOatk8MoKo582D9Peow",
      Authorization:
        "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ6cmptbmNhd21iaXd5YmtmZXZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU4NjM5MDQsImV4cCI6MjA2MTQzOTkwNH0.fZH4Fc4wDSH_YNjx4pfHsh8rdOatk8MoKo582D9Peow",
      Accept: "application/json",
    },
  }
).then((res) => {
  if (!res.ok) throw new Error(`Fetch error: ${res.status} ${res.statusText}`);
  return res.json();
});

console.log(data);
---

<MainLayout title="Kaffevaerk">
  <section class="relative w-full h-screen overflow-hidden">
    <!-- Video baggrund -->
    <div class="relative w-full h-screen">
      <video
        src={herovideo}
        class="absolute inset-0 w-full h-full object-cover"
        autoplay
        muted
        loop></video>

      <!-- Mørk overlay for bedre kontrast -->
      <!-- <div class="absolute top-0 left-0 w-full h-full bg-black/40"></div> -->

      <!-- Tekst og CTA ovenpå -->
      <div
        class="relative z-10 flex flex-col items-center justify-center h-full text-center px-4 space-y-6"
      >
        <h1 class="text-[#F9F6F1] georama text-[40px] md:text-[96px]">
          Ristet med passion <br /> serveret med kærlighed
        </h1>
        <h2 class="text-[#F9F6F1] georama text-[20px] md:text-[32px]">
          Oplev smagen af håndværk – friskristet kaffe, nøje udvalgt og skabt
          til at nydes.
        </h2>

        <!-- CTA Knap -->
        <a
          href="/shop"
          class="manrope text-[16px] font-medium md:text-[18px] bg-[#577866] hover:bg-[#455F50] text-[#F9F6F1] px-6 py-4 transition duration-300 mt-10 md:px-6 md:py-4"
        >
          Køb din kaffe
        </a>
      </div>
    </div>
  </section>

  <!-- Udvalgte produkter -->
  <section class="md:my-20">
    <h2
      class="text-[#2B2B2B] georama text-[40px] mt-5 mb-5 text-center md:text-[64px] md:text-left md:px-16"
    >
      Udvalgte produkter
    </h2>

    <div class="flex flex-col md:flex-row md:space-x-6 justify-center">
      {
        data.slice(0, 3).map((produkt, i) => {
          // Grøn (0), blå (1), grøn (2)
          const colors = ["#577866", "#6C8EA4", "#577866"];
          const bgColor = colors[i] || "#577866";

          return (
            <div class="md:w-1/3">
              <Produkter data={produkt} bgColor={bgColor} />
            </div>
          );
        })
      }
    </div>

    <div class="flex justify-center">
      <a
        href="/shop"
        class="manrope text-[16px] font-medium md:text-[18px] bg-[#577866] hover:bg-[#455F50] text-[#F9F6F1] px-6 py-4 transition duration-300 mt-5"
      >
        Se alle produkter
      </a>
    </div>
  </section>

  <!-- Om Kaffevaerk -->
  <section class="bg-[#946654] py-10 mt-10">
    <div class="grid md:grid-cols-2 items-center mx-auto px-5">
      <!-- Billede -->
      <Image
        src={barista}
        alt="Barista"
        class="w-full md:w-[90%] md:h-[450px] object-cover mx-auto"
      />

      <!-- Tekst -->
      <div class="max-w-xl mx-auto">
        <h2
          class="text-[#F9F6F1] text-center georama text-[40px] my-5 md:text-[64px] md:text-left"
        >
          Vores kaffeunivers
        </h2>
        <p class="manrope text-[#F9F6F1] text-[16px] leading-relaxed">
          Hos Kaffevaerk handler det ikke bare om kaffe – det handler om
          kvalitet, bæredygtighed og passion. Vi rister kaffe med hjertet på
          vores eget risteri, og vi arbejder tæt sammen med vores dygtige
          farmere for at sikre en kaffeoplevelse, der smager lige så godt, som
          den føles. Vores kaffe er sporbar og bæredygtig, hvilket betyder, at
          du ikke kun får en fantastisk smagsoplevelse, men også er med til at
          støtte etisk produktion. <br /><br />
          Velkommen til en verden af friskristet kaffe – lavet med omhu, leveret
          med kærlighed.
        </p>
      </div>
    </div>
  </section>

  <section class="md:grid md:grid-cols-2 gap-4">
    <Image src={kaffekop} alt="" class="mt-10 h-[400px] object-cover" />
    <Image
      src={kaffeplante2}
      alt=""
      class="mt-5 md:mt-10 h-[400px] object-cover"
    />
  </section>

  <!-- Kundeanmdelser -->
  <section class="bg-[#577866] mt-10 py-4 pb-10 md:pt-10 md:pb-32">
    <h2
      class="text-[#F9F6F1] georama text-[40px] mt-5 mb-5 text-center md:text-[64px] md:text-left md:px-16 md:mb-20"
    >
      Det siger vores kunder
    </h2>

    <div class="md:grid md:grid-cols-3 md:gap-6 md:px-16">
      <Anmeldelse
        text="Det er tydeligt, at Kaffevaerk går op i hver eneste detalje – fra ristning til smag. Jeg har aldrig haft så mange forskellige favoritbønner samlet på én gang."
        author="— Signe Katrine Madsen"
      />
      <Anmeldelse
        text="Jeg har fået Kaffevaerk anbefalet af en ven, og nu drikker jeg det hver dag. Deres kaffe smager friskt, og man bliver næsten afhængig på den gode måde."
        author="— Anders Birk Thomsen"
      />
      <Anmeldelse
        text="Man mærker virkelig kvaliteten. Ikke bare i smagen, men også i indpakningen og kommunikationen. Det føles som et brand med sjæl."
        author="— Louise Vestergaard"
      />
    </div>
  </section>

  <!-- Instagram -->
  <section class="bg-[#F9F6F1] mt-10 mb-10">
    <h2
      class="text-[#2B2B2B] georama text-[40px] mx-5 mb-3 text-center md:text-[64px]"
    >
      Følg med på Instagram
    </h2>
    <h3 class="text-[#2B2B2B] georama text-[24px] mb-10 text-center">
      <a
        href="https://www.instagram.com/kaffevaerkcph"
        target="_blank"
        rel="noopener noreferrer"
      >
        @kaffevaerkcph
      </a>
    </h3>

    <div
      class="flex flex-col md:flex-row gap-6 justify-center items-center px-4"
    >
      <Image
        src={instagram1}
        alt="Instagram billede 1"
        class="w-full md:w-1/3 object-cover"
      />
      <Image
        src={instagram2}
        alt="Instagram billede 2"
        class="w-full md:w-1/3 object-cover"
      />
      <Image
        src={instagram3}
        alt="Instagram billede 3"
        class="w-full md:w-1/3 object-cover"
      />
    </div>
  </section>
</MainLayout>

<script>
  const reviews = [
    {
      text: "Det er tydeligt, at Kaffevaerk går op i hver eneste detalje – fra ristning til smag. Jeg har aldrig haft så mange favoritbønner på én gang.",
      author: "— Signe Katrine Madsen",
    },
    {
      text: "Jeg har fået Kaffevaerk anbefalet af en ven, og nu drikker jeg det hver dag. Deres kaffe smager friskt, og man bliver næsten afhængig på den gode måde.",
      author: "— Anders Birk Thomsen",
    },
    {
      text: "Man mærker virkelig kvaliteten. Ikke bare i smagen, men også i indpakningen og kommunikationen. Det føles som et brand med sjæl.",
      author: "— Louise Vestergaard",
    },
  ];

  const reviewText = document.getElementById("reviewText");
  const reviewAuthor = document.getElementById("reviewAuthor");
  const starsContainer = document.getElementById("starsContainer");
  const reviewIndex = document.getElementById("reviewIndex");

  let currentIndex = 0;
  const total = reviews.length;

  function renderReview(index) {
    const review = reviews[index];
    reviewText.textContent = review.text;
    reviewAuthor.textContent = review.author;

    starsContainer.innerHTML = "";
    for (let i = 0; i < 5; i++) {
      const star = document.createElement("img");
      star.src = "stjerne.svg";
      star.alt = "Anmeldelsesstjerne";
      star.className = "w-[35px] h-[30px]";
      starsContainer.appendChild(star);
    }

    reviewIndex.textContent = `${index + 1} / ${total}`;
  }

  function nextReview() {
    currentIndex = (currentIndex + 1) % total;
    renderReview(currentIndex);
  }

  // Start med at vise første anmeldelse
  renderReview(currentIndex);

  // Skift anmeldelse automatisk hvert 4. sekund
  setInterval(nextReview, 1000);
</script>
